<!-- HTML header for doxygen 1.8.20-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Interleaved LLC Converter Firmware: Interleaved LLC Converter Firmware</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mchp.css" rel="stylesheet" type="text/css"/>
<link href="mchp_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="border:0px; border-spacing: 0px; border-collapse: collapse; vertical-align: middle; width: 100%;">
    <tbody>
        <tr style="border: none; background-color: #00000000;">
            <!--SITE HEADER-->
            <td style="width: 120px; border: none;">
                <img alt="Bar" height="60px" src="images/mchp-brandingelement-rgb2.png"/>
            </td>
            <td style="width: 220px; border: none;">
                <img alt="Logo" height=50px src="images/microchip.png"/>
            </td>
            <td colspan="4" style="font-size: 16pt; font-weight: bolder;">
                Interleaved LLC Converter Firmware (Part-No. EV84C64A) 
            </td>
            <td style="text-align: right; vertical-align: middle;">
                        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
            </td>
            <!--END SITE HEADER-->
        </tr>
        <tr style="height:36px; border:none; background-color: #000000b0;">
            <td style="width: 70px; color: white; font-size:14px; font-weight: bolder; margin-left: 30px;">
                <div style="margin-left: 30px;">Content</div>
            </td>
            <td style="width: 10px; color: white; font-size:14px; font-weight: bolder;">
                &nbsp;
            </td>
            <td style="width: 100px; color: white; font-size:14px; font-weight: bolder;">
                <!--Overview -->
            </td>
            <td style="width: 130px; color: white; font-size:14px; font-weight: bolder;"> 
                <!--Documentation -->
            </td>
            <td style="width: 170px; color: white; font-size:14px; font-weight: bolder;"> 
                <!--Additional Resources -->
            </td>
            <td style="width: auto; color: white; font-size:14px; font-weight: bolder;"> 
              &nbsp;
            </td>
            <td style="width: 310px; margin-right: 30px; color: white; font-size:10px; font-weight: lighter; text-align: right;">
                &nbsp;
            </td>
        </tr>
    </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Interleaved LLC Converter Firmware </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a><img src="microchip.png" alt="" class="inline" title="image"/></p>
<hr  />
<h1><a class="anchor" id="autotoc_md30"></a>
dsPIC33 Interleaved LLC Converter</h1>
<h3><a class="anchor" id="autotoc_md31"></a>
2 phase Interleaved LLC converter with voltage mode control and phase current balancing.</h3>
<center><a href="https://www.microchip.com/en-us/development-tool/EV84C64A" target="_blank" rel="nofollow"><img src="images/illc-00.png" alt="dsPIC33C Interleaved LLC Converter" width="700" class="inline"/> </a></center><center> <a href="https://www.microchip.com/en-us/development-tool/EV84C64A" target="_blank" rel="nofollow">dsPIC33 Interleaved LLC Converter Power Board. </a> </center> <p ><span id="start-doc"><a class="anchor" id="start-doc"></a></span></p>
<hr  />
<p> <span id="summary"><a class="anchor" id="summary"></a> </span></p>
<h2><a class="anchor" id="autotoc_md33"></a>
Summary</h2>
<p >This solution demonstrates the implementation of an interleaved (2 phase) LLC converter using voltage mode control on the 50W Interleaved LLC Converter Development Board.</p>
<p >The 50W Interleaved LLC Converter Development Board is a generic development board for this topology that supports rapid prototyping and code development based on dsPIC33 devices. The board provides two identical half-bridge stages with LLC tank circuitry at the primary and voltage doubler rectification at the secondary. The board offers well organized building blocks that include an input filter, power stage, AUX supply, mating socket for Microchip’s newest Digital Power Plug-In Modules (DP PIMs), Human Machine Interface (HMI) and test points. The electrical characteristics are prepared to allow safe voltage levels of up to 50 VDC in and up to 12 VDC out. Topology and design are scalable and can be easily turned into real industrial demands targeting 400 VDC or 800 VDC bus operating voltage. A mating socket for dsPIC33 plug-in modules allows the system to be evaluated with different controllers. The pinout is compatible for EP, CK and CH dsPIC® DSC DP PIMs. A Human-Machine-Interface (HMI) and test points allow for easy evaluation and debugging.</p>
<p >[<a href="#start-doc">back to top</a>] </p><hr  />
<p ><span id="highlights"><a class="anchor" id="highlights"></a> </span></p>
<h2><a class="anchor" id="autotoc_md34"></a>
Highlights</h2>
<ul>
<li>Digitally-Controlled Two-Phase Interleaved LLC Resonant DC-DC Converter.</li>
<li>Accurate current sharing between phases without any additional hardware.</li>
<li>Utilization of dsPIC peripherals to achieve switching frequency range between 800kHz and 1MHz.</li>
<li>Soft-start with both duty cycle and frequency modulation for smooth output voltage ramp without current surges.</li>
</ul>
<p >[<a href="#start-doc">back to top</a>]</p>
<hr  />
<p ><span id="related-collateral"><a class="anchor" id="related-collateral"></a> </span></p>
<h2><a class="anchor" id="autotoc_md35"></a>
Related Documentation</h2>
<p ><b>Firmware documentation</b></p>
<ul>
<li><a href="https://microchip-pic-avr-examples.github.io/llc50w-power-voltage-mode-control-with-active-current-sharing">Online Firmware Documentation of this Code Example</a></li>
</ul>
<p ><b>Hardware Documentation</b></p>
<ul>
<li><a href="https://www.microchip.com/en-us/development-tool/EV84C64A">Interleaved LLC Development Board Product Webpage</a></li>
</ul>
<p ><b>Target Device Documentation</b></p>
<ul>
<li><a href="https://www.microchip.com/70005349">dsPIC33CK256MP508 Family Data Sheet</a></li>
<li><a href="https://www.microchip.com/80000796">dsPIC33CK256MP508 Family Silicon Errata and Data Sheet Clarification</a></li>
</ul>
<p ><b>Please always check for the latest data sheets on the respective product websites:</b></p>
<ul>
<li><a href="https://www.microchip.com/dsPIC33CK256MP508">dsPIC33CK256MP508 Family</a></li>
<li><a href="https://www.microchip.com/dsPIC33CH512MP508">dsPIC33CH512MP508 Family</a></li>
</ul>
<hr  />
<p ><span id="software-tools-used"><a class="anchor" id="software-tools-used"></a> </span></p>
<h2><a class="anchor" id="autotoc_md36"></a>
Software Used</h2>
<ul>
<li><a href="https://www.microchip.com/en-us/software-library/power_board_visualizer">Power Board Visualizer GUI</a></li>
<li><a href="https://www.microchip.com/mplabx-ide-windows-installer">MPLAB&reg; X IDE v5.50</a></li>
<li><a href="https://www.microchip.com/mplabxc16windows">MPLAB&reg; XC16 Compiler v1.70</a></li>
<li><a href="https://www.microchip.com/mplab/mplab-code-configurator">Microchip Code Configurator v5.0.3</a></li>
<li><a href="https://www.microchip.com/developmenttools/ProductDetails/DCDT">Digital Compensator Design Tool</a></li>
<li><a href="https://www.microchip.com/en-us/development-tools-tools-and-software/embedded-software-center/mplab-mindi-analog-simulator">MPLAB&reg; Mindi™ Simulator</a></li>
</ul>
<p ><span id="hardware-used"><a class="anchor" id="hardware-used"></a> </span></p>
<h2><a class="anchor" id="autotoc_md37"></a>
Hardware Used</h2>
<ul>
<li>Interleaved LLC Development Board, Part-No. <a href="https://www.microchip.com/en-us/development-tool/EV84C64A">EV84C64A</a></li>
<li>dsPIC33CK256MP506 Digital Power PIM, Part-No. <a href="https://www.microchip.com/MA330048">MA330048</a></li>
</ul>
<p >[<a href="#start-doc">back to top</a>]</p>
<hr  />
<p ><span id="quick-start-guide"><a class="anchor" id="quick-start-guide"></a> </span></p>
<h2><a class="anchor" id="autotoc_md38"></a>
Quick Start Guide</h2>
<p >In this section we describe how to bring up the board both in open loop and closed loop modes, and with and without using the Power Board Visualizer GUI.</p>
<p ><span id="human-machine-interface"><a class="anchor" id="human-machine-interface"></a> </span></p>
<h3><a class="anchor" id="autotoc_md39"></a>
Human Machine Interface</h3>
<p >The interleaved LLC board has a simple Human-Machine-Interface (HMI) with LEDs showing status, and push buttons for control. This is shown below.</p>
<center> <img src="images/illc-28.png" alt="hmi-control" width="1200" class="inline"/> <br  />
 HMI LEDs and push buttons on the ILLC power board. </center> <p >The USER button control action is outlined in the table below.</p>
<center> <img src="images/illc-24.png" alt="hmi-control" width="900" class="inline"/> <br  />
 HMI control USER push button action. </center> <p >The board status as shown by the LEDs on the ILLC power board and the DP-PIM is outlined below.</p>
<center> <img src="images/illc-25.png" alt="hmi-status" width="900" class="inline"/> <br  />
 HMI status LEDs. </center> <p >[<a href="#start-doc">back to top</a>] </p><hr  />
<p ><span id="testing-the-board-in-open-loop-mode"><a class="anchor" id="testing-the-board-in-open-loop-mode"></a> </span></p>
<h3><a class="anchor" id="autotoc_md40"></a>
Testing the Board in Open-Loop Mode</h3>
<p >The hardware connections for running the board in open loop mode is shown below.</p>
<center> <img src="images/illc-23.png" alt="state-machine" width="900" class="inline"/> <br  />
 Hardware connections. </center> <p >Note that we use the ICD4 in-circuit debugger to program the dsPIC, but any type of Microchip In-Circuit Debugger can be used here.</p>
<p >Please follow these steps to run the ILLC board in open loop mode.</p>
<p >(1) Connect computer directly to DP-PIM via USB cable (USB Micro Type-B on DP-PIM).</p>
<p >(2) Connect computer to ICD4 via USB cable, connect ICD4 to 6 pin header on DP-PIM via RJ11 cable and RJ11 to ICSP adapter.</p>
<p >(3) Connect poti (5kR or 10kR) to 6 pin header on LLC power board as shown above.</p>
<p >(4) Set poti wiper to max setting.</p>
<p >(5) Connect input terminal of LLC power board to DC source capable of providing at least 40V. Leave DC source off for now.</p>
<p >(6) Connect scope probe to TP100 (this is phase A high-side primary drive signal) ensuring to ground the scope at GND_S (not GND_P).</p>
<p >(7) Connect a voltmeter to the output terminals of the LLC power board.</p>
<p >(8) Connect output terminals of LLC power board to resistive or constant current load (set current load to around 0.5A or resistive load to around 20R), turn on the load if it is an e-load.</p>
<p >(9) Open ILLC project in MPLABx. Set as the main project, then download the firmware to the dsPIC on the DP-PIM.</p>
<p >(10) When the firmware is running, you should see</p>
<ul>
<li>the red LED on the DP-PIM slow blinking, indicating that the firmware is running.</li>
<li>the green LED on the power board slow blinking, indicating that the power supply is not running.</li>
<li>the red LED on the power board is on, indicating that a fault is active.</li>
</ul>
<p >(11) Set the DC source to 40V. Set current limit to 1.2A or lower. Turn on DC source.</p>
<p >(12) Short press the USER button on the LLC power board. This turns on the converter. The status LEDs should behave as follows:</p><ul>
<li>Green LED on power board constant on, indicating that the power supply is running.</li>
<li>Red LED on power board slow-blinking, indicating that open-loop mode is active.</li>
</ul>
<p >(13) Check the PWM signal on TP100 with an oscilloscope. The signal should have a frequency of around 1MHz, and a duty cycle of 45%.</p>
<p >(14) Check the output voltage with the voltmeter: with 0.5A load, it should be around 7.4V.</p>
<p >(15) Move the poti wiper slowly towards the min setting. While doing this, observe the signal on TP100 and the output voltage, you should see the frequency of the signal on TP100 decreasing, the duty staying (approximately) the same, and the output voltage increasing.</p>
<p >(16) With the poti wiper at the min setting, the signal on TP100 should have a frequency of 800kHz and a duty cycle of 45%. With a 0.5A load, the output voltage should be around 10.7V.</p>
<p >Note that at power-up, the firmware checks if a potentiometer is connected, and if so, the voltage on the potentiometer wiper sets the output voltage reference. If a potentiometer is not connected, the output voltage reference is fixed at 9V. The firmware will not detect that the poti is present if the poti is connected after power up, so you need to reset the dsPIC if this is the case.</p>
<p >[<a href="#start-doc">back to top</a>] </p><hr  />
<p ><span id="testing-the-board-in-closed-loop-mode"><a class="anchor" id="testing-the-board-in-closed-loop-mode"></a> </span></p>
<h3><a class="anchor" id="autotoc_md41"></a>
Testing the Board in Closed-Loop Mode</h3>
<ol type="1">
<li>Turn off the power supply if it is running by short pressing the USER button.</li>
<li>Press and hold the USER button for at least two seconds to change the working mode from open loop to closed loop. The red LED on the power board should turn off.</li>
<li>Short press the USER button to enable the power supply.</li>
<li>Check for valid output voltage and switching signal on TP100.</li>
<li>If the potentiometer is connected, moving the potentiometer wiper position will change the output voltage reference.</li>
<li>If the potentiometer is not used, the output voltage should be around 9V (TP100 signal should have frequency of around 870kHz and duty of 45%).</li>
<li><p class="startli">Using the board in closed-Loop mode creates a controlled stable output voltage. It must be independent from input voltage or load changes. The reference for the output voltage can be set with a potentiometer and/or with the Power Board Visualizer GUI.</p>
<p class="startli">We discuss using the Power Board Visualizer GUI in the next section.</p>
</li>
</ol>
<p >[<a href="#start-doc">back to top</a>]</p>
<hr  />
<p ><span id="setting-up-and-connecting-the-power-board-visualizer-gui"><a class="anchor" id="setting-up-and-connecting-the-power-board-visualizer-gui"></a> </span></p>
<h3><a class="anchor" id="autotoc_md42"></a>
Setting Up and Connecting the Power Board Visualizer GUI</h3>
<ol type="1">
<li>Ensure that the firmware is running on the DP-PIM and that the DP-PIM is connected to your computer via a USB cable.</li>
<li>Open the Power Board Visualizer application on your computer.</li>
<li>On the window that appears, click "Open Project", then navigate to the "gui" folder in the ILLC firmware installation directory, and click on "ILLC_R1.xml".</li>
<li>The ILLC landing page will open. Click on the "COM?" button on the bottom of this page.</li>
<li>Select the port which is used for the serial connection between your computer and the DP-PIM from the pull-down menu. Click "OK" and you will be brought back to the ILLC GUI landing page.</li>
<li>Click on the "Enable" button on the bottom of the landing page. This will initiate comms between the GUI and the firmware running on the DP-PIM.</li>
<li>When the comms is working, the "Communication status" indicator on the bottom of the LLC GUI landing page should flash alternating red and green.</li>
</ol>
<p >With Microchips Power Board Visualizer GUI we can easily visualize values and states visible on the ILLC Demo Board. We can also change the output voltage reference (closed loop only) and switching frequency (open loop only) on the running power supply with the GUI.</p>
<p >On the "Status" tab we show an example below with the main values like voltages and currents as well as status bits from the power controller and Faults.</p>
<center> <img src="images/illc-26.png" alt="board-power-visualizer-00" width="1200" class="inline"/> <br  />
 Power Board Visualizer Landing Page. <br  />
 </center> <p >On the "Schematic diagram" tab there is the power supply block diagram with online updates of the most important values for easy understanding the working principles. This is shown below.</p>
<center> <img src="images/illc-27.png" alt="board-power-visualizer-01" width="1000" class="inline"/> <br  />
 Power Board Visualizer Schematic Diagram page. </center> <p >[<a href="#start-doc">back to top</a>]</p>
<hr  />
<p >&copy; 2021, Microchip Technology Inc. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.20-->
<!-- start footer part -->
<div id="nav-path" class="navpath" style="padding-bottom: 12px; vertical-align: bottom;"><!-- id is needed for treeview function! -->
  <ul>
    <p class="footer" style="text-align: center; font-size: 90%;">
      © Copyright 1998-2021 Microchip Technology Inc. All rights reserved.
    </p>
    </ul>
</div>
</body>
</html>
